[Rainmeter]
Update=10000
AccurateText=1
DynamicWindowSize=1

[Variables]
; === 在这里设置你的时间 ===
; 开始时间 (格式: HH:MM, 24小时制，例如 09:00 代表早上9点)
StartTime=10:00
; 结束时间 (格式: HH:MM, 例如 18:30 代表下午6点30分)
EndTime=20:00

; === 进度阶段分隔点设置 ===
; 第一阶段结束点 (百分比, 0-100, 小于此值使用 BarColor1)
Stage1End=25
; 第二阶段结束点 (百分比, 0-100, 大于 Stage1End 且小于此值使用 BarColor2)
Stage2End=75
; 第三阶段开始于 Stage2End

; === 外观设置 ===
; 进度条颜色阶段 (R,G,B,透明度)
BarColor1=100,200,100,255
BarColor2=50,170,250,250
BarColor3=255,200,50,255
; 背景颜色
BgColor=100,130,130,150
; 宽度和高度
W=300
H=12
; 字体大小
FontSize=9
; 文字颜色 (R,G,B,透明度)
TextColor=30,30,30,255
PercentColor=255,255,255,255
; 透明颜色 (完成后隐藏)
TransparentColor=0,0,0,0

; ==========================
; 以下逻辑不需要修改
; ==========================

[MeasureTime]
Measure=Time
Format=%H

[MeasureTimeM]
Measure=Time
Format=%M

; 计算当前是今天的第几分钟
[MeasureCurrentMinutes]
Measure=Calc
Formula=(MeasureTime * 60 + MeasureTimeM)

; 解析开始时间的小时和分钟
[MeasureStartHour]
Measure=String
String=#StartTime#
RegExpSubstitute=1
Substitute="^(\\d+):(\\d+)$":"\\1"

[MeasureStartMinute]
Measure=String
String=#StartTime#
RegExpSubstitute=1
Substitute="^(\\d+):(\\d+)$":"\\2"

; 解析结束时间的小时和分钟
[MeasureEndHour]
Measure=String
String=#EndTime#
RegExpSubstitute=1
Substitute="^(\\d+):(\\d+)$":"\\1"

[MeasureEndMinute]
Measure=String
String=#EndTime#
RegExpSubstitute=1
Substitute="^(\\d+):(\\d+)$":"\\2"

; 计算开始时间的总分钟数
[MeasureStartTotalMinutes]
Measure=Calc
Formula=(Floor([MeasureStartHour:]) * 60 + Floor([MeasureStartMinute:]))
DynamicVariables=1

; 计算结束时间的总分钟数
[MeasureEndTotalMinutes]
Measure=Calc
Formula=(Floor([MeasureEndHour:]) * 60 + Floor([MeasureEndMinute:]))
DynamicVariables=1

; 计算工作时段总分钟数
[MeasureTotalMinutes]
Measure=Calc
Formula=(MeasureEndTotalMinutes - MeasureStartTotalMinutes)
DynamicVariables=1

; 计算当前进度百分比 (限制在 0-1 之间)
[MeasureProgress]
Measure=Calc
Formula=Clamp((MeasureCurrentMinutes - MeasureStartTotalMinutes) / Max(MeasureTotalMinutes, 1), 0, 1)
MinValue=0
MaxValue=1
DynamicVariables=1

; 计算已过去的分钟数
[MeasureElapsedMinutes]
Measure=Calc
Formula=Max(0, MeasureCurrentMinutes - MeasureStartTotalMinutes)
DynamicVariables=1

; 计算剩余分钟数
[MeasureRemainingMinutes]
Measure=Calc
Formula=Max(0, MeasureTotalMinutes - MeasureElapsedMinutes)

; 计算显示的百分比文字
[MeasurePercentText]
Measure=Calc
Formula=MeasureProgress * 100
MinValue=0
MaxValue=100

; 根据进度设置颜色
[MeasureColorStage]
Measure=Calc
Formula=MeasurePercentText
IfBelowValue=#Stage1End#
IfBelowAction=[!SetOption MeterBar BarColor "#BarColor1#"]
IfAboveValue=(#Stage1End# - 0.001)
IfAboveAction=[!SetOption MeterBar BarColor "#BarColor2#"]

[MeasureColorStage2]
Measure=Calc
Formula=MeasurePercentText
IfAboveValue=(#Stage2End# - 0.001)
IfAboveAction=[!SetOption MeterBar BarColor "#BarColor3#"]

[MeasureColorStage3]
Measure=Calc
Formula=MeasurePercentText
IfAboveValue=99.999
IfAboveAction=[!SetOption MeterBar BarColor "#TransparentColor#"][!SetOption MeterBackground SolidColor "#TransparentColor#"][!SetOption MeterPercent FontColor "#TransparentColor#"][!SetOption MeterTimeInfo FontColor "#TransparentColor#"]

[MeterBackground]
Meter=Image
W=#W#
H=#H#
SolidColor=#BgColor#
X=0
Y=0

[MeterBar]
Meter=Bar
MeasureName=MeasureProgress
W=#W#
H=#H#
BarColor=#BarColor2#
BarOrientation=Horizontal
X=0
Y=0

[MeterTimeInfo]
Meter=String
MeasureName=MeasureElapsedMinutes
MeasureName2=MeasureTotalMinutes
MeasureName3=MeasureRemainingMinutes
Text="%1 / %2 - %3"
FontColor=#TextColor#
FontSize=#FontSize#
AntiAlias=1
StringAlign=Left
X=5
Y=0
NumOfDecimals=0

[MeterPercent]
Meter=String
MeasureName=MeasurePercentText
Text="%1%"
FontColor=#PercentColor#
FontSize=#FontSize#
AntiAlias=1
StringAlign=Right
X=(#W# - 5)
Y=0
NumOfDecimals=1